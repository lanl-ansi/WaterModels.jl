<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mathematical Models · WaterModels</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-367975-10', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.svg" alt="WaterModels logo"/></a><div class="docs-package-name"><span class="docs-autofit">WaterModels</span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="quickguide.html">Getting Started</a></li><li><a class="tocitem" href="network-data.html">Network Data Format</a></li><li><a class="tocitem" href="result-data.html">Result Data Format</a></li><li class="is-active"><a class="tocitem" href="math-model.html">Mathematical Models</a><ul class="internal"><li><a class="tocitem" href="#Notation-for-Sets"><span>Notation for Sets</span></a></li><li><a class="tocitem" href="#Physical-Feasibility"><span>Physical Feasibility</span></a></li><li><a class="tocitem" href="#Nonconvex-Nonlinear-Program"><span>Nonconvex Nonlinear Program</span></a></li><li><a class="tocitem" href="#Mixed-integer-Convex-Program"><span>Mixed-integer Convex Program</span></a></li><li><a class="tocitem" href="#Mixed-integer-Linear-Program"><span>Mixed-integer Linear Program</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="formulations.html">Network Formulations</a></li><li><a class="tocitem" href="specifications.html">Problem Specifications</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Modeling Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="model.html">WaterModel</a></li><li><a class="tocitem" href="objective.html">Objective</a></li><li><a class="tocitem" href="variables.html">Variables</a></li><li><a class="tocitem" href="constraints.html">Constraints</a></li></ul></li><li><a class="tocitem" href="relaxations.html">Relaxation Schemes</a></li><li><a class="tocitem" href="parser.html">File I/O</a></li></ul></li><li><a class="tocitem" href="developer.html">Developer</a></li><li><a class="tocitem" href="benchmarks.html">Benchmarks</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="math-model.html">Mathematical Models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="math-model.html">Mathematical Models</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lanl-ansi/WaterModels.jl/blob/master/docs/src/math-model.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mathematical-Models-in-WaterModels"><a class="docs-heading-anchor" href="#Mathematical-Models-in-WaterModels">Mathematical Models in WaterModels</a><a id="Mathematical-Models-in-WaterModels-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-Models-in-WaterModels" title="Permalink"></a></h1><h2 id="Notation-for-Sets"><a class="docs-heading-anchor" href="#Notation-for-Sets">Notation for Sets</a><a id="Notation-for-Sets-1"></a><a class="docs-heading-anchor-permalink" href="#Notation-for-Sets" title="Permalink"></a></h2><p>A water distribution network is represented by a directed graph <span>$\mathcal{G} := (\mathcal{N}, \mathcal{L})$</span>, where <span>$\mathcal{N}$</span> is the set of nodes and <span>$\mathcal{L}$</span> is the set of arcs (conventionally &quot;links,&quot; e.g., <a href="http://wateranalytics.org/EPANET/_pipes_page.html">pipes</a> and <a href="http://wateranalytics.org/EPANET/_valves_page.html">valves</a>). Temporal evolution of the network is represented by a set <span>$\mathcal{K}$</span>, denoting the set of all time steps considered. In summary, the following sets are commonly used when defining a WaterModels problem formulation:</p><table><tr><th style="text-align: left">Notation</th><th style="text-align: left">WaterModels Translation</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><span>$\mathcal{N}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:node]</code></td><td style="text-align: left">nodes (to which nodal-type components are attached)</td></tr><tr><td style="text-align: left"><span>$\mathcal{K}$</span></td><td style="text-align: left"><code>nw_ids(wm)</code></td><td style="text-align: left">time indices (multinetwork indices labeled by <code>n</code>)</td></tr><tr><td style="text-align: left"><span>$\mathcal{J}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:junction]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_juncs_page.html">junctions</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{R}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:reservoir]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_resv_page.html">reservoirs</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{T}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:tank]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_tanks_page.html">tanks</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{A} \subset \mathcal{L}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:pipe]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_pipes_page.html">pipes</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{C} \subset \mathcal{L}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:check_valve]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_pipes_page.html">pipes with check valves</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{P} \subset \mathcal{L}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:pump]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_pumps_page.html">pumps</a></td></tr></table><h2 id="Physical-Feasibility"><a class="docs-heading-anchor" href="#Physical-Feasibility">Physical Feasibility</a><a id="Physical-Feasibility-1"></a><a class="docs-heading-anchor-permalink" href="#Physical-Feasibility" title="Permalink"></a></h2><h3 id="Nodes"><a class="docs-heading-anchor" href="#Nodes">Nodes</a><a id="Nodes-1"></a><a class="docs-heading-anchor-permalink" href="#Nodes" title="Permalink"></a></h3><h4 id="Junctions"><a class="docs-heading-anchor" href="#Junctions">Junctions</a><a id="Junctions-1"></a><a class="docs-heading-anchor-permalink" href="#Junctions" title="Permalink"></a></h4><h4 id="Reservoirs"><a class="docs-heading-anchor" href="#Reservoirs">Reservoirs</a><a id="Reservoirs-1"></a><a class="docs-heading-anchor-permalink" href="#Reservoirs" title="Permalink"></a></h4><h4 id="Tanks"><a class="docs-heading-anchor" href="#Tanks">Tanks</a><a id="Tanks-1"></a><a class="docs-heading-anchor-permalink" href="#Tanks" title="Permalink"></a></h4><h3 id="Links"><a class="docs-heading-anchor" href="#Links">Links</a><a id="Links-1"></a><a class="docs-heading-anchor-permalink" href="#Links" title="Permalink"></a></h3><h4 id="Pipes-Without-Check-Valves"><a class="docs-heading-anchor" href="#Pipes-Without-Check-Valves">Pipes Without Check Valves</a><a id="Pipes-Without-Check-Valves-1"></a><a class="docs-heading-anchor-permalink" href="#Pipes-Without-Check-Valves" title="Permalink"></a></h4><h4 id="Pipes-with-Check-Valves"><a class="docs-heading-anchor" href="#Pipes-with-Check-Valves">Pipes with Check Valves</a><a id="Pipes-with-Check-Valves-1"></a><a class="docs-heading-anchor-permalink" href="#Pipes-with-Check-Valves" title="Permalink"></a></h4><h4 id="Pipes-with-Shutoff-Valves"><a class="docs-heading-anchor" href="#Pipes-with-Shutoff-Valves">Pipes with Shutoff Valves</a><a id="Pipes-with-Shutoff-Valves-1"></a><a class="docs-heading-anchor-permalink" href="#Pipes-with-Shutoff-Valves" title="Permalink"></a></h4><h4 id="Pressure-Reducing-Valves"><a class="docs-heading-anchor" href="#Pressure-Reducing-Valves">Pressure Reducing Valves</a><a id="Pressure-Reducing-Valves-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-Reducing-Valves" title="Permalink"></a></h4><h4 id="Pumps"><a class="docs-heading-anchor" href="#Pumps">Pumps</a><a id="Pumps-1"></a><a class="docs-heading-anchor-permalink" href="#Pumps" title="Permalink"></a></h4><h3 id="Satisfaction-of-Flow-Bounds"><a class="docs-heading-anchor" href="#Satisfaction-of-Flow-Bounds">Satisfaction of Flow Bounds</a><a id="Satisfaction-of-Flow-Bounds-1"></a><a class="docs-heading-anchor-permalink" href="#Satisfaction-of-Flow-Bounds" title="Permalink"></a></h3><p>For each arc <span>$(i, j) \in \mathcal{L}$</span>, a variable <span>$q_{ij}$</span> is used to represent the volumetric flow of water across the arc (in <span>$\textrm{m}^{3}/\textrm{s}$</span>). When <span>$q_{ij}$</span> is positive, flow on arc <span>$(i, j)$</span> travels from node <span>$i$</span> to node <span>$j$</span>. When <span>$q_{ij}$</span> is negative, flow travels from node <span>$j$</span> to node <span>$i$</span>. The absolute value of flow along the arc can be bounded by physical capacity, engineering judgment, or network analysis. Having tight bounds is crucial for optimization applications. For example, maximum flow speed and the diameter of the pipe can be used to bound <span>$q_{ij}$</span> as per</p><div>\[    -\frac{\pi}{4} v_{ij}^{\max} D_{ij}^{2} \leq q_{ij} \leq \frac{\pi}{4} v_{ij}^{\max} D_{ij}^{2},\]</div><p>where <span>$D_{ij}$</span> is the diameter of pipe <span>$(i, j)$</span> and <span>$v^{\max}_{ij}$</span> is the maximum flow speed along the pipe.</p><h3 id="Satisfaction-of-Head-Bounds"><a class="docs-heading-anchor" href="#Satisfaction-of-Head-Bounds">Satisfaction of Head Bounds</a><a id="Satisfaction-of-Head-Bounds-1"></a><a class="docs-heading-anchor-permalink" href="#Satisfaction-of-Head-Bounds" title="Permalink"></a></h3><p>Each node potential is denoted by <span>$h_{i}$</span>, <span>$i \in \mathcal{N}$</span>, and represents the hydraulic head in units of length (<span>$\textrm{m}$</span>). The hydraulic head assimilates the elevation and pressure heads at each node, while the velocity head can typically be neglected. For each reservoir <span>$i \in \mathcal{R}$</span>, the hydraulic head is assumed to be fixed at a value <span>$h_{i}^{\textrm{src}}$</span>, i.e.,</p><div>\[    h_{i} = h_{i}^{\textrm{src}}, \; \forall i \in \mathcal{R}.\]</div><p>For each junction <span>$i \in \mathcal{J}$</span>, a minimum hydraulic head <span>$\underline{h}_{i}$</span>, determined a priori, must first be satisfied. In the interest of tightening the optimization formulation, upper bounds on hydraulic heads can also typically be implied from other network data, e.g.,</p><div>\[    \underline{h}_{i} \leq h_{i} \leq \overline{h}_{i} = \max_{i \in \mathcal{R}}\{h_{i}^{\textrm{src}}\}.\]</div><h3 id="Conservation-of-Flow"><a class="docs-heading-anchor" href="#Conservation-of-Flow">Conservation of Flow</a><a id="Conservation-of-Flow-1"></a><a class="docs-heading-anchor-permalink" href="#Conservation-of-Flow" title="Permalink"></a></h3><h3 id="Head-Loss-Relationships"><a class="docs-heading-anchor" href="#Head-Loss-Relationships">Head Loss Relationships</a><a id="Head-Loss-Relationships-1"></a><a class="docs-heading-anchor-permalink" href="#Head-Loss-Relationships" title="Permalink"></a></h3><p>In water distribution networks, flow along a pipe is induced by the difference in potential (head) between the two nodes that connect that pipe. The relationships that link flow and hydraulic head are commonly referred to as the &quot;head loss equations&quot; or &quot;potential-flow constraints,&quot; and are generally of the form</p><div>\[	h_{i} - h_{j} = \Phi_{ij}(q_{ij}),\]</div><p>where <span>$\Phi_{ij} : \mathbb{R} \to \mathbb{R}$</span> is a strictly increasing function with rotational symmetry about the origin. Embedding the above equation in a mathematical program clearly introduces nonconvexity. (That is, the function <span>$\Phi_{ij}(q_{ij})$</span> is nonconvex <em>and</em> the relationship must be satisfied with equality.) As such, different formulations primarily aim to effectively deal with these types of nonconvex constraints in an optimization setting.</p><p>Explicit forms of the head loss equation include the <a href="https://en.wikipedia.org/wiki/Darcy-Weisbach_equation">Darcy-Weisbach</a> equation, i.e.,</p><div>\[	h_{i} - h_{j} = \frac{8 L_{ij} \lambda_{ij} q_{ij} \lvert q_{ij} \rvert}{\pi^{2} g D_{ij}^{5}}\]</div><p>and the <a href="https://en.wikipedia.org/wiki/Hazen-Williams_equation">Hazen-Williams</a> equation, i.e.,</p><div>\[	h_{i} - h_{j} = \frac{10.67 L_{ij} q_{ij} \lvert q_{ij} \rvert^{0.852}}{\kappa_{ij}^{1.852} D_{ij}^{4.87}}.\]</div><p>In these equations, <span>$L_{ij}$</span> represents the length of pipe <span>$(i, j) \in \mathcal{A}$</span>, <span>$\lambda_{ij}$</span> represents the friction factor, <span>$g$</span> is the acceleration due to gravity, and <span>$\kappa_{ij}$</span> is the roughness coefficient, which depends on the material of the pipe. In the Darcy-Weisbach formulation, <span>$\lambda_{ij}$</span> depends on the Reynolds number (and thus the flow <span>$q_{ij}$</span>) in a nonlinear manner. In WaterModels.jl, the <a href="https://en.wikipedia.org/wiki/Darcy_friction_factor_formulae#Swamee%E2%80%93Jain_equation">Swamee-Jain equation</a> is used, which serves as an explicit approximation of the implicit <a href="https://en.wikipedia.org/wiki/Darcy_friction_factor_formulae#Colebrook%E2%80%93White_equation">Colebrook-White</a> equation. The equation computes the friction factor <span>$\lambda_{ij}$</span> for <span>$(i, j) \in \mathcal{A}$</span> as</p><div>\[	\lambda_{ij} = \frac{0.25}{\left[\log \left(\frac{\epsilon_{ij} / D_{ij}}{3.7} + \frac{5.74}{\textrm{Re}_{ij}^{0.9}}\right)\right]^{2}}.\]</div><p>where <span>$\epsilon_{ij}$</span> is the pipe&#39;s effective roughness and the Reynold&#39;s number <span>$\textrm{Re}_{ij}$</span> is defined as</p><div>\[	\textrm{Re}_{ij} = \frac{D_{ij} v_{ij} \rho}{\mu},\]</div><p>where <span>$v_{ij}$</span> is the mean flow speed, <span>$\rho$</span> is the density, and <span>$\mu$</span> is the viscosity. Herein, to remove the source of nonlinearity in the Swamee-Jain equation, <span>$v_{ij}$</span> is estimated a priori, making the overall resistance term fixed.</p><p>When all variables in a head loss equation <em>except</em> <span>$q_{ij}$</span> are fixed (as in the relations described above), both the Darcy-Weisbach and Hazen-Williams formulations for head loss reduce to a convenient form, namely</p><div>\[	h_{i} - h_{j} = L_{ij} r_{ij} q_{ij} \lvert q_{ij} \rvert^{\alpha}.\]</div><p>Here, <span>$r_{ij}$</span> represents the resistance per unit length, and <span>$\alpha$</span> is the exponent required by the head loss relationship (i.e., one for Darcy-Weisbach and <span>$0.852$</span> for Hazen-Williams). Thus, the Darcy-Weisbach resistance per unit length is</p><div>\[	r_{ij} = \frac{8 \lambda_{ij}}{\pi^{2} g D_{ij}^{5}},\]</div><p>and the Hazen-Williams resistance per unit length is</p><div>\[	r_{ij} = \frac{10.67}{\kappa_{ij}^{1.852} D_{ij}^{4.87}}.\]</div><h2 id="Nonconvex-Nonlinear-Program"><a class="docs-heading-anchor" href="#Nonconvex-Nonlinear-Program">Nonconvex Nonlinear Program</a><a id="Nonconvex-Nonlinear-Program-1"></a><a class="docs-heading-anchor-permalink" href="#Nonconvex-Nonlinear-Program" title="Permalink"></a></h2><p>The full nonconvex formulation of the physical feasibility problem (NCNLP), which incorporates all requirements from <a href="#Physical-Feasibility-1">Physical Feasibility</a>, may be written as a system that satisfies the following constraints:</p><div>\[\begin{align}
    h_{i} - h_{j} &amp;= L_{ij} r_{ij} q_{ij} \lvert q_{ij} \rvert^{\alpha}, ~ \forall (i, j) \in \mathcal{A} \label{eqn:ncnlp-head-loss} \\
    h_{i} &amp;= h_{i}^{\textrm{src}}, ~ \forall i \in \mathcal{S} \label{eqn:ncnlp-head-source} \\
    \sum_{(j, i) \in \mathcal{A}^{-}(i)} q_{ji} - \sum_{(i, j) \in \mathcal{A}^{+}(i)} q_{ij} &amp;= q_{i}^{\textrm{dem}}, ~ \forall i \in \mathcal{J} \label{eqn:ncnlp-flow-conservation} \\
    \underline{h}_{i} \leq h_{i} &amp;\leq \overline{h}_{i}, ~ \forall i \in \mathcal{J} \label{eqn:ncnlp-head-bounds} \\
    \underline{q}_{ij} \leq q_{ij} &amp;\leq \overline{q}_{ij}, ~ \forall (i, j) \in \mathcal{A} \label{eqn:ncnlp-flow-bounds}.
\end{align}\]</div><p>Here, Constraints <span>$\eqref{eqn:ncnlp-head-loss}$</span> are <a href="#Head-Loss-Relationships-1">head loss relationships</a>, Constraints <span>$\eqref{eqn:ncnlp-head-source}$</span> are <a href="#Satisfaction-of-Head-Bounds-1">head bounds</a> at source nodes, Constraints <span>$\eqref{eqn:ncnlp-flow-conservation}$</span> are <a href="#Conservation-of-Flow">flow conservation constraints</a>, Constraints <span>$\eqref{eqn:ncnlp-head-bounds}$</span> <a href="#Satisfaction-of-Head-Bounds-1">head bounds</a> at junctions, and Constraints <span>$\eqref{eqn:ncnlp-flow-bounds}$</span> are <a href="#Satisfaction-of-Flow-Bounds-1">flow bounds</a>. Note that the sources of nonconvexity and nonlinearity are Constraints <span>$\eqref{eqn:ncnlp-head-loss}$</span>.</p><h2 id="Mixed-integer-Convex-Program"><a class="docs-heading-anchor" href="#Mixed-integer-Convex-Program">Mixed-integer Convex Program</a><a id="Mixed-integer-Convex-Program-1"></a><a class="docs-heading-anchor-permalink" href="#Mixed-integer-Convex-Program" title="Permalink"></a></h2><h2 id="Mixed-integer-Linear-Program"><a class="docs-heading-anchor" href="#Mixed-integer-Linear-Program">Mixed-integer Linear Program</a><a id="Mixed-integer-Linear-Program-1"></a><a class="docs-heading-anchor-permalink" href="#Mixed-integer-Linear-Program" title="Permalink"></a></h2></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="result-data.html">« Result Data Format</a><a class="docs-footer-nextpage" href="formulations.html">Network Formulations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Sunday 23 August 2020 01:07">Sunday 23 August 2020</span>. Using Julia version 1.5.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
