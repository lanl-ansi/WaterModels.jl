<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mathematical Models · WaterModels</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-367975-10', 'auto');
ga('send', 'pageview', {'page': location.pathname + location.search + location.hash});
</script><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="WaterModels logo"/></a><div class="docs-package-name"><span class="docs-autofit">WaterModels</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../quickguide/">Getting Started</a></li><li><a class="tocitem" href="../network-data/">Network Data Format</a></li><li><a class="tocitem" href="../result-data/">Result Data Format</a></li><li class="is-active"><a class="tocitem" href>Mathematical Models</a><ul class="internal"><li><a class="tocitem" href="#Notation-for-Sets-1"><span>Notation for Sets</span></a></li><li><a class="tocitem" href="#Physical-Feasibility-1"><span>Physical Feasibility</span></a></li><li><a class="tocitem" href="#Non-convex-Nonlinear-Program-1"><span>Non-convex Nonlinear Program</span></a></li><li><a class="tocitem" href="#Convex-Nonlinear-Program-1"><span>Convex Nonlinear Program</span></a></li><li><a class="tocitem" href="#Mixed-integer-Convex-Program-1"><span>Mixed-integer Convex Program</span></a></li><li><a class="tocitem" href="#Mixed-integer-Linear-Program-1"><span>Mixed-integer Linear Program</span></a></li><li><a class="tocitem" href="#Network-Design-1"><span>Network Design</span></a></li></ul></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../formulations/">Network Formulations</a></li><li><a class="tocitem" href="../specifications/">Problem Specifications</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Modeling Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../model/">WaterModel</a></li><li><a class="tocitem" href="../objective/">Objective</a></li><li><a class="tocitem" href="../variables/">Variables</a></li><li><a class="tocitem" href="../constraints/">Constraints</a></li></ul></li><li><a class="tocitem" href="../relaxations/">Relaxation Schemes</a></li><li><a class="tocitem" href="../parser/">File I/O</a></li></ul></li><li><a class="tocitem" href="../developer/">Developer</a></li><li><a class="tocitem" href="../experiment-results/">Experiment Results</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href>Mathematical Models</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mathematical Models</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/lanl-ansi/WaterModels.jl/blob/master/docs/src/math-model.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mathematical-Models-in-WaterModels-1"><a class="docs-heading-anchor" href="#Mathematical-Models-in-WaterModels-1">Mathematical Models in WaterModels</a><a class="docs-heading-anchor-permalink" href="#Mathematical-Models-in-WaterModels-1" title="Permalink"></a></h1><h2 id="Notation-for-Sets-1"><a class="docs-heading-anchor" href="#Notation-for-Sets-1">Notation for Sets</a><a class="docs-heading-anchor-permalink" href="#Notation-for-Sets-1" title="Permalink"></a></h2><p>A water distribution network is represented by a directed graph <span>$\mathcal{G} := (\mathcal{N}, \mathcal{L})$</span>, where <span>$\mathcal{N}$</span> is the set of nodes (e.g., <a href="http://wateranalytics.org/EPANET/_juncs_page.html">junctions</a> and <a href="http://wateranalytics.org/EPANET/_resv_page.html">reservoirs</a>) and <span>$\mathcal{L}$</span> is the set of arcs (conventionally &quot;links,&quot; e.g., <a href="http://wateranalytics.org/EPANET/_pipes_page.html">pipes</a> and <a href="http://wateranalytics.org/EPANET/_valves_page.html">valves</a>). Temporal evolution of the network is represented by a set <span>$\mathcal{K}$</span>, denoting the set of all time steps considered. The set of junctions is denoted by <span>$\mathcal{J} \subset \mathcal{N}$</span>, the set of reservoirs (or sources) by <span>$\mathcal{R} \subset \mathcal{N}$</span>, and the set of tanks by <span>$\mathcal{T} \subset \mathcal{N}$</span>. The set of pipes in the network is denoted by <span>$\mathcal{A} \subset \mathcal{L}$</span>, the set of pipes with check valves by <span>$\mathcal{C} \subset \mathcal{A}$</span>, and the set of pumps by <span>$\mathcal{P} \subset \mathcal{L}$</span>. The set of links incident to node <span>$i \in \mathcal{N}$</span>, where <span>$i$</span> is the tail of the arc, is denoted by <span>$\delta^{+}_{i} := \{(i, j) \in \mathcal{L}\}$</span>. The set of links incident to node <span>$i \in \mathcal{N}$</span>, where <span>$i$</span> is the head of the arc, is denoted by <span>$\delta^{-}_{i} := \{(j, i) \in \mathcal{L}\}$</span>. In summary, the following sets are commonly used when defining a WaterModels problem formulation:</p><table><tr><th style="text-align: left">Notation</th><th style="text-align: left">WaterModels Translation</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><span>$\mathcal{N}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:node]</code></td><td style="text-align: left">nodes</td></tr><tr><td style="text-align: left"><span>$\mathcal{L}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:link]</code></td><td style="text-align: left">links</td></tr><tr><td style="text-align: left"><span>$\mathcal{K}$</span></td><td style="text-align: left"><code>nw_ids(wm)</code></td><td style="text-align: left">time indices (multinetwork indices labeled by <code>n</code>)</td></tr><tr><td style="text-align: left"><span>$\mathcal{J} \subset \mathcal{N}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:junction]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_juncs_page.html">junctions</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{R} \subset \mathcal{N}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:reservoir]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_resv_page.html">reservoirs</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{T} \subset \mathcal{N}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:tank]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_tanks_page.html">tanks</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{A} \subset \mathcal{L}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:pipe]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_pipes_page.html">pipes</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{C} \subset \mathcal{L}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:check_valve]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_pipes_page.html">pipes with check valves</a></td></tr><tr><td style="text-align: left"><span>$\mathcal{P} \subset \mathcal{L}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:pump]</code></td><td style="text-align: left"><a href="http://wateranalytics.org/EPANET/_pumps_page.html">pumps</a></td></tr><tr><td style="text-align: left"><span>$\delta_{i}^{+} \subset \mathcal{A}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:link_to][i]</code></td><td style="text-align: left">links &quot;from&quot; node <span>$i$</span></td></tr><tr><td style="text-align: left"><span>$\delta_{i}^{-} \subset \mathcal{A}$</span></td><td style="text-align: left"><code>wm.ref[:nw][n][:link_fr][i]</code></td><td style="text-align: left">links &quot;to&quot; node <span>$i$</span></td></tr></table><h2 id="Physical-Feasibility-1"><a class="docs-heading-anchor" href="#Physical-Feasibility-1">Physical Feasibility</a><a class="docs-heading-anchor-permalink" href="#Physical-Feasibility-1" title="Permalink"></a></h2><h3 id="Nodes-1"><a class="docs-heading-anchor" href="#Nodes-1">Nodes</a><a class="docs-heading-anchor-permalink" href="#Nodes-1" title="Permalink"></a></h3><h4 id="Junctions-1"><a class="docs-heading-anchor" href="#Junctions-1">Junctions</a><a class="docs-heading-anchor-permalink" href="#Junctions-1" title="Permalink"></a></h4><h4 id="Reservoirs-1"><a class="docs-heading-anchor" href="#Reservoirs-1">Reservoirs</a><a class="docs-heading-anchor-permalink" href="#Reservoirs-1" title="Permalink"></a></h4><h4 id="Tanks-1"><a class="docs-heading-anchor" href="#Tanks-1">Tanks</a><a class="docs-heading-anchor-permalink" href="#Tanks-1" title="Permalink"></a></h4><h3 id="Links-1"><a class="docs-heading-anchor" href="#Links-1">Links</a><a class="docs-heading-anchor-permalink" href="#Links-1" title="Permalink"></a></h3><h4 id="Pipes-Without-Check-Valves-1"><a class="docs-heading-anchor" href="#Pipes-Without-Check-Valves-1">Pipes Without Check Valves</a><a class="docs-heading-anchor-permalink" href="#Pipes-Without-Check-Valves-1" title="Permalink"></a></h4><h4 id="Pipes-with-Check-Valves-1"><a class="docs-heading-anchor" href="#Pipes-with-Check-Valves-1">Pipes with Check Valves</a><a class="docs-heading-anchor-permalink" href="#Pipes-with-Check-Valves-1" title="Permalink"></a></h4><h4 id="Pumps-1"><a class="docs-heading-anchor" href="#Pumps-1">Pumps</a><a class="docs-heading-anchor-permalink" href="#Pumps-1" title="Permalink"></a></h4><h3 id="Satisfaction-of-Flow-Bounds-1"><a class="docs-heading-anchor" href="#Satisfaction-of-Flow-Bounds-1">Satisfaction of Flow Bounds</a><a class="docs-heading-anchor-permalink" href="#Satisfaction-of-Flow-Bounds-1" title="Permalink"></a></h3><p>For each arc <span>$(i, j) \in \mathcal{A}$</span>, a variable <span>$q_{ij}$</span> is used to represent the volumetric flow of water across the arc (in <span>$\textrm{m}^{3}/\textrm{s}$</span>). When <span>$q_{ij}$</span> is positive, flow on arc <span>$(i, j)$</span> travels from node <span>$i$</span> to node <span>$j$</span>. When <span>$q_{ij}$</span> is negative, flow travels from node <span>$j$</span> to node <span>$i$</span>. The absolute value of flow along the arc can be bounded by physical capacity, engineering judgment, or network analysis. Having tight bounds is crucial for optimization applications. For example, maximum flow speed and the diameter of the pipe can be used to bound <span>$q_{ij}$</span> as per</p><div>\[    -\frac{\pi}{4} v_{ij}^{\max} D_{ij}^{2} \leq q_{ij} \leq \frac{\pi}{4} v_{ij}^{\max} D_{ij}^{2},\]</div><p>where <span>$D_{ij}$</span> is the diameter of pipe <span>$(i, j)$</span> and <span>$v^{\max}_{ij}$</span> is the maximum flow speed along the pipe.</p><h3 id="Satisfaction-of-Head-Bounds-1"><a class="docs-heading-anchor" href="#Satisfaction-of-Head-Bounds-1">Satisfaction of Head Bounds</a><a class="docs-heading-anchor-permalink" href="#Satisfaction-of-Head-Bounds-1" title="Permalink"></a></h3><p>Each node potential is denoted by <span>$h_{i}$</span>, <span>$i \in \mathcal{N}$</span>, and represents the hydraulic head in units of length (<span>$\textrm{m}$</span>). The hydraulic head assimilates the elevation and pressure heads at each node, while the velocity head can typically be neglected. For each reservoir <span>$i \in \mathcal{S}$</span>, the hydraulic head is assumed to be fixed at a value <span>$h_{i}^{\textrm{src}}$</span>, i.e.,</p><div>\[    h_{i} = h_{i}^{\textrm{src}}, \; \forall i \in \mathcal{S}.\]</div><p>For each junction <span>$i \in \mathcal{J}$</span>, a minimum hydraulic head <span>$\underline{h}_{i}$</span>, determined a priori, must first be satisfied. In the interest of tightening the optimization formulation, upper bounds on hydraulic heads can also typically be implied from other network data, e.g.,</p><div>\[    \underline{h}_{i} \leq h_{i} \leq \overline{h}_{i} = \max_{i \in \mathcal{S}}\{h_{i}^{\textrm{src}}\}.\]</div><h3 id="Conservation-of-Flow-at-Non-supply-Nodes-1"><a class="docs-heading-anchor" href="#Conservation-of-Flow-at-Non-supply-Nodes-1">Conservation of Flow at Non-supply Nodes</a><a class="docs-heading-anchor-permalink" href="#Conservation-of-Flow-at-Non-supply-Nodes-1" title="Permalink"></a></h3><p>Flow must be delivered throughout the network to satisfy fixed demand, <span>$q_{i}^{\textrm{dem}}$</span>, at non-supply nodes, i.e.,</p><div>\[	\sum_{(j, i) \in \mathcal{A}^{-}(i)} q_{ji} - \sum_{(i, j) \in \mathcal{A}^{+}(i)} q_{ij} = q_{i}^{\textrm{dem}}, ~ \forall i \in \mathcal{J},\]</div><p>where <span>$\mathcal{A}^{-}(i)$</span> and <span>$\mathcal{A}^{+}(i)$</span> are the sets of incoming and outgoing arcs of node <span>$i$</span>, respectively.</p><h3 id="Conservation-of-Flow-at-Supply-Nodes-1"><a class="docs-heading-anchor" href="#Conservation-of-Flow-at-Supply-Nodes-1">Conservation of Flow at Supply Nodes</a><a class="docs-heading-anchor-permalink" href="#Conservation-of-Flow-at-Supply-Nodes-1" title="Permalink"></a></h3><p>The <em>outflow</em> from each reservoir will be nonnegative by definition, i.e.,</p><div>\[	\sum_{(i, j) \in \mathcal{A}^{+}(i)} q_{ij} - \sum_{(j, i) \in \mathcal{A}^{-}(i)} q_{ji} \geq 0, ~ \forall i \in \mathcal{S}.\]</div><p>Additionally, an upper bound on the amount of flow delivered by a reservoir may be written</p><div>\[	 \sum_{(i, j) \in \mathcal{A}^{+}(i)} q_{ij} - \sum_{(j, i) \in \mathcal{A}^{-}(i)} q_{ji} \leq \sum_{k \in \mathcal{J}} q^{\textrm{dem}}_{k}, ~ \forall i \in \mathcal{R},\]</div><p>i.e., a reservoir will never send more flow than the amount required to serve all demand.</p><h3 id="Head-Loss-Relationships-1"><a class="docs-heading-anchor" href="#Head-Loss-Relationships-1">Head Loss Relationships</a><a class="docs-heading-anchor-permalink" href="#Head-Loss-Relationships-1" title="Permalink"></a></h3><p>In water distribution networks, flow along an arc is induced by the difference in potential (head) between the two nodes that connect that arc. The relationships that link flow and hydraulic head are commonly referred to as the &quot;head loss equations&quot; or &quot;potential-flow constraints,&quot; and are generally of the form</p><div>\[	h_{i} - h_{j} = \Phi_{ij}(q_{ij}),\]</div><p>where <span>$\Phi_{ij} : \mathbb{R} \to \mathbb{R}$</span> is a strictly increasing function with rotational symmetry about the origin. Embedding the above equation in a mathematical program clearly introduces non-convexity. (That is, the function <span>$\Phi_{ij}(q_{ij})$</span> is non-convex <em>and</em> the relationship must be satisfied with equality.) As such, different formulations primarily aim to effectively deal with these types of non-convex constraints in an optimization setting.</p><p>Explicit forms of the head loss equation include the <a href="https://en.wikipedia.org/wiki/Darcy-Weisbach_equation">Darcy-Weisbach</a> equation, i.e.,</p><div>\[	h_{i} - h_{j} = \frac{8 L_{ij} \lambda_{ij} q_{ij} \lvert q_{ij} \rvert}{\pi^{2} g D_{ij}^{5}}\]</div><p>and the <a href="https://en.wikipedia.org/wiki/Hazen-Williams_equation">Hazen-Williams</a> equation, i.e.,</p><div>\[	h_{i} - h_{j} = \frac{10.67 L_{ij} q_{ij} \lvert q_{ij} \rvert^{0.852}}{\kappa_{ij}^{1.852} D_{ij}^{4.87}}.\]</div><p>In these equations, <span>$L_{ij}$</span> represents the length of pipe <span>$(i, j) \in \mathcal{A}$</span>, <span>$\lambda_{ij}$</span> represents the friction factor, <span>$g$</span> is the acceleration due to gravity, and <span>$\kappa_{ij}$</span> is the roughness coefficient, which depends on the material of the pipe. In the Darcy-Weisbach formulation, <span>$\lambda_{ij}$</span> depends on the Reynolds number (and thus the flow <span>$q_{ij}$</span>) in a nonlinear manner. In WaterModels.jl, the <a href="https://en.wikipedia.org/wiki/Darcy_friction_factor_formulae#Swamee%E2%80%93Jain_equation">Swamee-Jain equation</a> is used, which serves as an explicit approximation of the implicit <a href="https://en.wikipedia.org/wiki/Darcy_friction_factor_formulae#Colebrook%E2%80%93White_equation">Colebrook-White</a> equation. The equation computes the friction factor <span>$\lambda_{ij}$</span> for <span>$(i, j) \in \mathcal{A}$</span> as</p><div>\[	\lambda_{ij} = \frac{0.25}{\left[\log \left(\frac{\epsilon_{ij} / D_{ij}}{3.7} + \frac{5.74}{\textrm{Re}_{ij}^{0.9}}\right)\right]^{2}}.\]</div><p>where <span>$\epsilon_{ij}$</span> is the pipe&#39;s effective roughness and the Reynold&#39;s number <span>$\textrm{Re}_{ij}$</span> is defined as</p><div>\[	\textrm{Re}_{ij} = \frac{D_{ij} v_{ij} \rho}{\mu},\]</div><p>where <span>$v_{ij}$</span> is the mean flow speed, <span>$\rho$</span> is the density, and <span>$\mu$</span> is the viscosity. Herein, to remove the source of nonlinearity in the Swamee-Jain equation, <span>$v_{ij}$</span> is estimated a priori, making the overall resistance term fixed.</p><p>When all variables in a head loss equation <em>except</em> <span>$q_{ij}$</span> are fixed (as in the relations described above), both the Darcy-Weisbach and Hazen-Williams formulations for head loss reduce to a convenient form, namely</p><div>\[	h_{i} - h_{j} = L_{ij} r_{ij} q_{ij} \lvert q_{ij} \rvert^{\alpha}.\]</div><p>Here, <span>$r_{ij}$</span> represents the resistance per unit length, and <span>$\alpha$</span> is the exponent required by the head loss relationship (i.e., one for Darcy-Weisbach and <span>$0.852$</span> for Hazen-Williams). Thus, the Darcy-Weisbach resistance per unit length is</p><div>\[	r_{ij} = \frac{8 \lambda_{ij}}{\pi^{2} g D_{ij}^{5}},\]</div><p>and the Hazen-Williams resistance per unit length is</p><div>\[	r_{ij} = \frac{10.67}{\kappa_{ij}^{1.852} D_{ij}^{4.87}}.\]</div><h2 id="Non-convex-Nonlinear-Program-1"><a class="docs-heading-anchor" href="#Non-convex-Nonlinear-Program-1">Non-convex Nonlinear Program</a><a class="docs-heading-anchor-permalink" href="#Non-convex-Nonlinear-Program-1" title="Permalink"></a></h2><p>The full non-convex formulation of the physical feasibility problem (NCNLP), which incorporates all requirements from <a href="#Physical-Feasibility-1">Physical Feasibility</a>, may be written as a system that satisfies the following constraints:</p><div>\[\begin{align}
    h_{i} - h_{j} &amp;= L_{ij} r_{ij} q_{ij} \lvert q_{ij} \rvert^{\alpha}, ~ \forall (i, j) \in \mathcal{A} \label{eqn:ncnlp-head-loss} \\
    h_{i} &amp;= h_{i}^{\textrm{src}}, ~ \forall i \in \mathcal{S} \label{eqn:ncnlp-head-source} \\
    \sum_{(j, i) \in \mathcal{A}^{-}(i)} q_{ji} - \sum_{(i, j) \in \mathcal{A}^{+}(i)} q_{ij} &amp;= q_{i}^{\textrm{dem}}, ~ \forall i \in \mathcal{J} \label{eqn:ncnlp-flow-conservation} \\
    \underline{h}_{i} \leq h_{i} &amp;\leq \overline{h}_{i}, ~ \forall i \in \mathcal{J} \label{eqn:ncnlp-head-bounds} \\
    \underline{q}_{ij} \leq q_{ij} &amp;\leq \overline{q}_{ij}, ~ \forall (i, j) \in \mathcal{A} \label{eqn:ncnlp-flow-bounds}.
\end{align}\]</div><p>Here, Constraints <span>$\eqref{eqn:ncnlp-head-loss}$</span> are <a href="#Head-Loss-Relationships-1">head loss relationships</a>, Constraints <span>$\eqref{eqn:ncnlp-head-source}$</span> are <a href="#Satisfaction-of-Head-Bounds-1">head bounds</a> at source nodes, Constraints <span>$\eqref{eqn:ncnlp-flow-conservation}$</span> are <a href="#Conservation-of-Flow-at-Non-supply-Nodes-1">flow conservation constraints</a>, Constraints <span>$\eqref{eqn:ncnlp-head-bounds}$</span> <a href="#Satisfaction-of-Head-Bounds-1">head bounds</a> at junctions, and Constraints <span>$\eqref{eqn:ncnlp-flow-bounds}$</span> are <a href="#Satisfaction-of-Flow-Bounds-1">flow bounds</a>. Note that the sources of non-convexity and nonlinearity are Constraints <span>$\eqref{eqn:ncnlp-head-loss}$</span>.</p><h2 id="Convex-Nonlinear-Program-1"><a class="docs-heading-anchor" href="#Convex-Nonlinear-Program-1">Convex Nonlinear Program</a><a class="docs-heading-anchor-permalink" href="#Convex-Nonlinear-Program-1" title="Permalink"></a></h2><p>Note that the sources of non-convexity and nonlinearity in the full <a href="#Non-convex-Nonlinear-Program-1">non-convex formulation of the physical feasibility problem</a> are Constraints <span>$\eqref{eqn:ncnlp-head-loss}$</span>. Because of the symmetry of the head loss relationship, the problem can be modeled instead as a disjunctive program. Here, the disjunction arises from the direction of flow, i.e.,</p><div>\[\begin{equation}
   \left[
	\begin{aligned}[c]
		 h_{i} - h_{j} &amp;= L_{ij} r_{ij} q_{ij}^{1 + \alpha} \\
              q_{ij} &amp;\geq 0
	\end{aligned}
   \right]
   \lor
   \left[
	\begin{aligned}[c]
		 h_{i} - h_{j} &amp;= L_{ij} r_{ij} (-q_{ij})^{1 + \alpha} \\
              q_{ij} &amp;&lt; 0
	\end{aligned}
   \right], ~ \forall (i, j) \in \mathcal{A}, \label{eqn:dnlp-head-loss}
\end{equation}\]</div><p>which replaces Constraints <span>$\eqref{eqn:ncnlp-head-loss}$</span> in the <a href="#Non-convex-Nonlinear-Program-1">NCNLP formulation</a>. To model the disjunction, each flow variable <span>$q_{ij}$</span> can be decomposed into two nonnegative flow variables, <span>$q_{ij}^{+}$</span> and <span>$q_{ij}^{-}$</span>, where <span>$q_{ij} := q_{ij}^{+} - q_{ij}^{-}$</span>. With this in mind, the following <em>convex</em> nonlinear program (CNLP) can be formulated, which is adapted from Section 3 of <a href="https://epubs.siam.org/doi/abs/10.1137/110827387"><em>Global Optimization of Nonlinear Network Design</em> by Raghunathan (2013)</a>:</p><div>\[\begin{align}
    &amp; \text{minimize}
    &amp; &amp; \sum_{(i, j) \in \mathcal{A}} \frac{L_{ij} r_{ij}}{2 + \alpha} \left[(q_{ij}^{+})^{2 + \alpha} + (q_{ij}^{-})^{2 + \alpha}\right] - \sum_{i \in \mathcal{S}} h_{i}^{\textrm{src}} \left(\sum_{(i, j) \in \mathcal{A}^{-}(i)} (q_{ij}^{+} - q_{ij}^{-}) - \sum_{(j, i) \in \mathcal{A}^{+}(i)} (q_{ji}^{+} - q_{ji}^{-})\right) \\
    &amp; \text{subject to}
    &amp; &amp; \sum_{(j, i) \in \mathcal{A}^{-}(i)} (q_{ji}^{+} - q_{ji}^{-}) - \sum_{(i, j) \in \mathcal{A}^{+}(i)} (q_{ij}^{+} - q_{ij}^{-}) = q_{i}^{\textrm{dem}}, ~ \forall i \in \mathcal{J} \label{eqn:cnlp-flow-conservation} \\
    &amp; &amp; &amp; q_{ij}^{+}, q_{ij}^{-} \geq 0, ~ \forall (i, j) \in \mathcal{A} \label{eqn:cnlp-flow-bounds}.
\end{align}\]</div><div>\[\renewcommand{\hat}[1]{\widehat{#1}}\]</div><p>Suppose that <span>$\hat{\mathbf{q}}^{+}, \hat{\mathbf{q}}^{-} \in \mathbb{R}^{\lvert A \rvert}$</span> solves (CNLP) with the associated dual solution <span>$\hat{\mathbf{h}} \in \mathbb{R}^{\lvert \mathcal{J} \rvert}$</span>, corresponding to the flow conservation Constraints <span>$\eqref{eqn:cnlp-flow-conservation}$</span>, and <span>$\hat{\mathbf{u}}^{+}, \hat{\mathbf{u}}^{-} \in \mathbb{R}^{\lvert \mathcal{A} \rvert}$</span>, corresponding to the nonnegativity Constraints <span>$\eqref{eqn:cnlp-flow-bounds}$</span>. This solution must satisfy the first-order necessary conditions</p><div>\[\begin{align}
    \hat{h}_{i} - \hat{h}_{j} &amp;= L_{ij} r_{ij} \hat{q}_{ij} \lvert q_{ij} \rvert^{\alpha}, ~ \forall (i, j) \in \mathcal{A} \\
    h_{i} &amp;= h_{i}^{\textrm{src}}, ~ \forall i \in \mathcal{S} \\
    \sum_{(j, i) \in \mathcal{A}^{-}(i)} q_{ji} - \sum_{(i, j) \in \mathcal{A}^{+}(i)} q_{ij} &amp;= q_{i}^{\textrm{dem}}, ~ \forall i \in \mathcal{J} \\
    \underline{h}_{i} \leq h_{i} &amp;\leq \overline{h}_{i}, ~ \forall i \in \mathcal{J} \\
    \underline{q}_{ij} \leq q_{ij} &amp;\leq \overline{q}_{ij}, ~ \forall (i, j) \in \mathcal{A}.
\end{align}\]</div><h2 id="Mixed-integer-Convex-Program-1"><a class="docs-heading-anchor" href="#Mixed-integer-Convex-Program-1">Mixed-integer Convex Program</a><a class="docs-heading-anchor-permalink" href="#Mixed-integer-Convex-Program-1" title="Permalink"></a></h2><h2 id="Mixed-integer-Linear-Program-1"><a class="docs-heading-anchor" href="#Mixed-integer-Linear-Program-1">Mixed-integer Linear Program</a><a class="docs-heading-anchor-permalink" href="#Mixed-integer-Linear-Program-1" title="Permalink"></a></h2><h2 id="Network-Design-1"><a class="docs-heading-anchor" href="#Network-Design-1">Network Design</a><a class="docs-heading-anchor-permalink" href="#Network-Design-1" title="Permalink"></a></h2><p>Currently, the primary formulation focuses on the problem of optimally designing a water distribution network. More specifically, given a network consisting of reservoirs, junctions, and pipes, the problem aims to select the most cost-effecient resistance from a discrete set of resistances for each pipe to meet demand over the entire network. The set of all possible resistances for a given pipe <span>$(i, j) \in \mathcal{A}$</span> is denoted by <span>$\mathcal{R}_{ij}$</span>, where each resistance is denoted by <span>$r \in \mathcal{R}_{ij}$</span>. A binary variable <span>$x^{r}_{ijr}$</span> is associated with each of these diameters to model the decision, i.e., <span>$x_{ijr}^{r} = 1$</span> if <span>$r$</span> is selected to serve as the pipe resistance, and <span>$x_{ijr}^{r} = 0$</span> otherwise. The cost per unit length of installing a pipe of resistance <span>$r$</span> is denoted by <span>$c_{ijr}$</span>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../result-data/">« Result Data Format</a><a class="docs-footer-nextpage" href="../formulations/">Network Formulations »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Wednesday 24 June 2020 19:35">Wednesday 24 June 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
