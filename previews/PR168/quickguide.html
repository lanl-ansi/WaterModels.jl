<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Getting Started · WaterModels</title><meta name="title" content="Getting Started · WaterModels"/><meta property="og:title" content="Getting Started · WaterModels"/><meta property="twitter:title" content="Getting Started · WaterModels"/><meta name="description" content="Documentation for WaterModels."/><meta property="og:description" content="Documentation for WaterModels."/><meta property="twitter:description" content="Documentation for WaterModels."/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-367975-10"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-367975-10', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.svg" alt="WaterModels logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">WaterModels</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><span class="tocitem">Manual</span><ul><li class="is-active"><a class="tocitem" href="quickguide.html">Getting Started</a><ul class="internal"><li><a class="tocitem" href="#Installation-of-WaterModels"><span>Installation of WaterModels</span></a></li><li><a class="tocitem" href="#Installation-of-an-Optimization-Solver"><span>Installation of an Optimization Solver</span></a></li><li><a class="tocitem" href="#Solving-a-Network-Design-Problem"><span>Solving a Network Design Problem</span></a></li><li><a class="tocitem" href="#Obtaining-Results"><span>Obtaining Results</span></a></li><li><a class="tocitem" href="#Accessing-Different-Formulations"><span>Accessing Different Formulations</span></a></li><li><a class="tocitem" href="#Modifying-Network-Data"><span>Modifying Network Data</span></a></li><li><a class="tocitem" href="#Alternative-Methods-for-Building-and-Solving-Models"><span>Alternative Methods for Building and Solving Models</span></a></li><li><a class="tocitem" href="#Solution-Unit-Conversion"><span>Solution Unit Conversion</span></a></li></ul></li><li><a class="tocitem" href="network-data.html">Network Data Format</a></li><li><a class="tocitem" href="result-data.html">Result Data Format</a></li><li><a class="tocitem" href="math-model.html">Mathematical Models</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="formulations.html">Network Formulations</a></li><li><a class="tocitem" href="specifications.html">Problem Specifications</a></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">Modeling Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="objective.html">Objective</a></li><li><a class="tocitem" href="variables.html">Variables</a></li><li><a class="tocitem" href="constraints.html">Constraints</a></li></ul></li><li><a class="tocitem" href="parser.html">File I/O</a></li></ul></li><li><a class="tocitem" href="developer.html">Developer</a></li><li><a class="tocitem" href="examples.html">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li class="is-active"><a href="quickguide.html">Getting Started</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="quickguide.html">Getting Started</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/lanl-ansi/WaterModels.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/lanl-ansi/WaterModels.jl/blob/master/docs/src/quickguide.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Quick-Start-Guide"><a class="docs-heading-anchor" href="#Quick-Start-Guide">Quick Start Guide</a><a id="Quick-Start-Guide-1"></a><a class="docs-heading-anchor-permalink" href="#Quick-Start-Guide" title="Permalink"></a></h1><p>The following guide walks through the solution of a water network design (<code>des</code>) problem using two mixed-integer linear programming (MILP) formulations (PWLRD and LRD) of the problem specification. This is to enable solution using the readily-available open-source MILP solver <a href="https://github.com/jump-dev/HiGHS.jl">HiGHS</a>. Other formulations rely on the availability of mixed-integer nonlinear programming (MINLP) solvers that support <a href="http://www.juliaopt.org/JuMP.jl/dev/nlp/#User-defined-Functions-1">user-defined nonlinear functions in JuMP</a>. However, these solvers (e.g., <a href="https://github.com/lanl-ansi/Juniper.jl">Juniper</a>, <a href="https://github.com/JuliaOpt/KNITRO.jl">KNITRO</a>) either require additional effort to register user-defined functions or are proprietary and require a commercial license.</p><h2 id="Installation-of-WaterModels"><a class="docs-heading-anchor" href="#Installation-of-WaterModels">Installation of WaterModels</a><a id="Installation-of-WaterModels-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-of-WaterModels" title="Permalink"></a></h2><p>The latest stable release of WaterModels can be installed using the Julia package manager with</p><pre><code class="language-julia hljs">] add WaterModels</code></pre><p>For the current development version, install the package using</p><pre><code class="language-julia hljs">] add WaterModels#master</code></pre><p>Finally, test that the package works as expected by executing</p><pre><code class="language-julia hljs">] test WaterModels</code></pre><h2 id="Installation-of-an-Optimization-Solver"><a class="docs-heading-anchor" href="#Installation-of-an-Optimization-Solver">Installation of an Optimization Solver</a><a id="Installation-of-an-Optimization-Solver-1"></a><a class="docs-heading-anchor-permalink" href="#Installation-of-an-Optimization-Solver" title="Permalink"></a></h2><p>At least one optimization solver is required to run WaterModels. The solver selected typically depends on the type of problem formulation being employed. Because in this example, we will be studying the linearization-based PWLRD and LRD formulations, we will leverage the open-source MILP solver HiGHS. Installation of the JuMP interface to HiGHS can be performed via the Julia package manager, i.e.,</p><pre><code class="language-julia hljs">] add HiGHS</code></pre><h2 id="Solving-a-Network-Design-Problem"><a class="docs-heading-anchor" href="#Solving-a-Network-Design-Problem">Solving a Network Design Problem</a><a id="Solving-a-Network-Design-Problem-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-a-Network-Design-Problem" title="Permalink"></a></h2><p>Once the above dependencies have been installed, obtain the file <a href="https://raw.githubusercontent.com/lanl-ansi/WaterModels.jl/master/examples/data/json/shamir.json"><code>shamir.json</code></a>. Here, <code>shamir.json</code> is a JSON file specifying the network, as well as possible pipe diameters and associated costs, per diameter setting. The file provides the required information to set up a corresponding network design problem, where the goal is to select the most cost-efficient pipe diameters while satisfying all demand in the network.</p><p>To read in the data, execute the following:</p><pre><code class="language-julia hljs">using WaterModels
data = parse_file(&quot;examples/data/json/shamir.json&quot;)</code></pre><p>Since we are using a linearization-based formulation of the problem, it is important to specify the partitioning of flows that parameterize the formulation. Here, we initialize linearization flow partitions that assume a head loss error tolerance of fifty meters, with widths between flow points no greater than 1.0e-4 cubic meters per second:</p><pre><code class="language-julia hljs">set_flow_partitions_si!(data, 50.0, 1.0e-4)</code></pre><p>Finally, the PWLRD formulation for the network design specification can be solved using</p><pre><code class="language-julia hljs">import HiGHS
solve_des(data, PWLRDWaterModel, HiGHS.Optimizer)</code></pre><p>The above flow partitioning, however, is somewhat coarse, and the number of points in each partition is typically three, e.g.,</p><pre><code class="language-julia hljs">data[&quot;des_pipe&quot;][&quot;3&quot;][&quot;flow_partition&quot;]</code></pre><p>The relaxation can be more finely discretized by using a smaller head loss error tolerance, e.g.,</p><pre><code class="language-julia hljs">set_flow_partitions_si!(data, 5.0, 1.0e-4)</code></pre><p>We can then solve the problem with the updated partitioning scheme via</p><pre><code class="language-julia hljs">import JuMP
highs = JuMP.optimizer_with_attributes(HiGHS.Optimizer, &quot;time_limit&quot; =&gt; 30.0)
solve_des(data, PWLRDWaterModel, highs)</code></pre><p>Note that this formulation takes much longer to solve to global optimality due to the use of more binary variables. However, because of the finer discretization, a better approximation of the physics is attained.</p><p>Instead of using piecewise-linear envelopes, head loss curves can also be simply outer-approximated via the LRD formulation. This formulation employs less strict requirements and avoids the use of binary variables for piecewise approximation, but solutions (e.g., diameters) may not be as close to feasibility with respect to the full (nonconvex) water network physics. To solve an LRD formulation of the problem using an even finer flow partitioning scheme (but without piecewise inner head loss approximations), the following can be executed:</p><pre><code class="language-julia hljs">set_flow_partitions_si!(data, 0.5, 1.0e-4)
solve_des(data, LRDWaterModel, HiGHS.Optimizer)</code></pre><p>This relaxation of the problem turns out to converge to the known globally optimal objective value.</p><h2 id="Obtaining-Results"><a class="docs-heading-anchor" href="#Obtaining-Results">Obtaining Results</a><a id="Obtaining-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Obtaining-Results" title="Permalink"></a></h2><p>For the rest of this tutorial, we will first assume a coarser relaxation by resetting the flow partitions as</p><pre><code class="language-julia hljs">set_flow_partitions_si!(data, 50.0, 1.0e-4)</code></pre><p>The <code>solve</code> commands in WaterModels return detailed results data in the form of a Julia <code>Dict</code>. This dictionary can be saved for further processing as follows:</p><pre><code class="language-julia hljs">result = solve_des(data, LRDWaterModel, HiGHS.Optimizer)</code></pre><p>For example, the algorithm&#39;s runtime and final objective value can be accessed with</p><pre><code class="language-julia hljs">result[&quot;solve_time&quot;] # Total solve time required (seconds).
result[&quot;objective&quot;] # Final objective value (in units of the objective).</code></pre><p>The <code>&quot;solution&quot;</code> field contains detailed information about the solution produced by the <code>solve</code> method. For example, the following dictionary comprehension can be used to inspect the flows in the solution:</p><pre><code class="language-julia hljs">flows = Dict(name =&gt; data[&quot;q&quot;] for (name, data) in result[&quot;solution&quot;][&quot;des_pipe&quot;])</code></pre><p>To determine the design pipes that were selected via the optimization, the following can be used:</p><pre><code class="language-julia hljs">pipes_selected = filter(x -&gt; x.second[&quot;status&quot;] == 1, result[&quot;solution&quot;][&quot;des_pipe&quot;])</code></pre><p>To retrieve the subset of the original pipe dataset, the following can be used:</p><pre><code class="language-julia hljs">pipes_subset = filter(x -&gt; x.first in keys(pipes_selected), data[&quot;des_pipe&quot;])</code></pre><p>For more information about WaterModels result data see the <a href="result-data.html#WaterModels-Result-Data-Format">WaterModels Result Data Format</a> section.</p><h2 id="Accessing-Different-Formulations"><a class="docs-heading-anchor" href="#Accessing-Different-Formulations">Accessing Different Formulations</a><a id="Accessing-Different-Formulations-1"></a><a class="docs-heading-anchor-permalink" href="#Accessing-Different-Formulations" title="Permalink"></a></h2><p>The MILP formulations discussed above assume access to a MILP solver. Nonconvex MINLP formulations can be solved with dedicated solvers, as well. For example, the nonconvex MINLP formulation for design (NC) can be solved via</p><pre><code class="language-julia hljs">import KNITRO
solve_des(data, NCWaterModel, KNITRO.Optimizer)</code></pre><h2 id="Modifying-Network-Data"><a class="docs-heading-anchor" href="#Modifying-Network-Data">Modifying Network Data</a><a id="Modifying-Network-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Modifying-Network-Data" title="Permalink"></a></h2><p>The following example demonstrates one way to perform multiple WaterModels solves while modifying network data:</p><pre><code class="language-julia hljs">solve_des(data, LRDWaterModel, HiGHS.Optimizer)

data[&quot;demand&quot;][&quot;3&quot;][&quot;flow_min&quot;] *= 0.5
data[&quot;demand&quot;][&quot;3&quot;][&quot;flow_max&quot;] *= 0.5
data[&quot;demand&quot;][&quot;3&quot;][&quot;flow_nominal&quot;] *= 0.5

solve_des(data, LRDWaterModel, HiGHS.Optimizer)</code></pre><p>Note that the smaller demands in the second problem result in an overall smaller design cost. For additional details about the network data, see the <a href="network-data.html#WaterModels-Network-Data-Format">WaterModels Network Data Format</a> section.</p><h2 id="Alternative-Methods-for-Building-and-Solving-Models"><a class="docs-heading-anchor" href="#Alternative-Methods-for-Building-and-Solving-Models">Alternative Methods for Building and Solving Models</a><a id="Alternative-Methods-for-Building-and-Solving-Models-1"></a><a class="docs-heading-anchor-permalink" href="#Alternative-Methods-for-Building-and-Solving-Models" title="Permalink"></a></h2><p>The following example demonstrates how to break a <code>solve_des</code> call into separate model building and solving steps. This allows inspection of the JuMP model created by WaterModels for the problem.</p><pre><code class="language-julia hljs">wm = instantiate_model(data, LRDWaterModel, WaterModels.build_des);

println(wm.model)

result = optimize_model!(wm, optimizer = HiGHS.Optimizer)</code></pre><h2 id="Solution-Unit-Conversion"><a class="docs-heading-anchor" href="#Solution-Unit-Conversion">Solution Unit Conversion</a><a id="Solution-Unit-Conversion-1"></a><a class="docs-heading-anchor-permalink" href="#Solution-Unit-Conversion" title="Permalink"></a></h2><p>The default behavior of WaterModels produces solution results in non-dimensionalized units. To recover solutions in SI units, the following function can be used:</p><pre><code class="language-julia hljs">make_si_units!(result[&quot;solution&quot;])</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="index.html">« Home</a><a class="docs-footer-nextpage" href="network-data.html">Network Data Format »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.10.1 on <span class="colophon-date" title="Friday 11 April 2025 01:51">Friday 11 April 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
